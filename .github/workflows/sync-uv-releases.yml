# For this action to work you must explicitly allow GitHub Actions to create pull requests.
# This setting can be found in a repository's settings under Actions > General > Workflow permissions.
# For repositories belonging to an organization, this setting can be managed by
# admins in organization settings under Actions > General > Workflow permissions.
name: Sync UV Releases
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    if: github.repository == 'astral-sh/rye'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Rye
        uses: eifinger/setup-rye@v2
        with:
          enable-cache: true
      - name: Sync UV Releases
        run: make sync-uv-releases
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Create PR
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "Sync latest UV releases"
          add-paths: "rye/src/sources/generated/uv_downloads.inc"
          branch: "sync-uv-releases"
          title: "Sync UV Releases"
          body: |
            - Synced latest UV releases

            <sup>Auto-generated by [sync-uv-releases.yml](https://github.com/astral-sh/rye/blob/main/.github/workflows/sync-uv-releases.yml)</sup>
